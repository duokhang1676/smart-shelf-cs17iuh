<!--
* Copyright 2025 Tran Vu Thuy Trang [C]
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
-->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</title>
    
    <!-- Critical Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Critical CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/guide.css') }}">
    
    <!-- Font CSS - Load asynchronously -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Aladin&family=Montserrat:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Aladin&family=Montserrat:wght@300;400;500;600;700&display=swap"></noscript>
    
    <!-- Module preload for critical JS -->
    <link rel="modulepreload" href="/static/js/navigation.js">
</head>
<body>
<!-- Navigation Bar -->
<nav class="navigation-bar">
    <div class="nav-brand">
        <span class="nav-brand-text">CS17IUH</span>
    </div>
    <div class="nav-links">
        <a href="/" class="nav-link" title="Trang ch·ªß">
            <span class="nav-text">Trang ch·ªß</span>
        </a>
        <a href="/shelf" class="nav-link" title="K·ªá s·∫£n ph·∫©m">
            <span class="nav-text">K·ªá h√†ng</span>
        </a>
        <a href="/combo" class="nav-link" title="Combo khuy·∫øn m√£i">
            <span class="nav-text">Combo</span>
        </a>
        <a href="/cart" class="nav-link" title="Gi·ªè h√†ng">
            <span class="nav-text">Gi·ªè h√†ng</span>
        </a>
        <a href="/guide" class="nav-link active" title="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng k·ªá">
            <span class="nav-text">H∆∞·ªõng d·∫´n</span>
        </a>
        <div class="nav-dropdown">
            <a href="#" class="nav-link" title="C√†i ƒë·∫∑t h·ªá th·ªëng" onclick="toggleSettingsDropdown(event)">
                <img src="/static/img/setting.png" alt="Settings">
            </a>
            <div class="dropdown-menu" id="settingsDropdown">
                <a href="/sensor-data" class="dropdown-item">
                    <span>D·ªØ li·ªáu m√¥i tr∆∞·ªùng</span>
                </a>
                <a href="/mobile-app" class="dropdown-item">
                    <span>Nh√¢n vi√™n</span>
                </a>
            </div>
        </div>
    </div>
</nav>

<div class="content-wrapper">
    <div class="container">
        <h1>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng k·ªá b√°n h√†ng t·ª± ƒë·ªông</h1>
        
        <div class="shelf-demo">            
            <div class="step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <div class="step-title">L·∫•y s·∫£n ph·∫©m tr√™n k·ªá</div>
                    <div class="step-description">
                        Vui l√≤ng l·∫•y s·∫£n ph·∫©m b·∫°n mu·ªën mua tr√™n k·ªá.
                    </div>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <div class="step-title">Ki·ªÉm tra gi·ªè h√†ng</div>
                    <div class="step-description">
                        Xem c√°c s·∫£n ph·∫©m ƒë√£ ch·ªçn, combo √°p d·ª•ng v√† ki·ªÉm tra t·ªïng ti·ªÅn.
                    </div>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <div class="step-title">X√°c nh·∫≠n thanh to√°n</div>
                    <div class="step-description">
                        B·∫•m n√∫t "X√°c nh·∫≠n thanh to√°n" ho·∫∑c n√≥i "Thanh to√°n".
                    </div>
                </div>
            </div>
            
            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <div class="step-title">In h√≥a ƒë∆°n</div>
                    <div class="step-description">
                        T√πy ch·ªçn in h√≥a ƒë∆°n.
                    </div>
                </div>
            </div>
            <div class="step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <div class="step-title">Qu√©t m√£ thanh to√°n</div>
                    <div class="step-description">
                        Qu√©t m√£ QR v√† th·ª±c hi·ªán thanh to√°n qua ng√¢n h√†ng ho·∫∑c v√≠ ƒëi·ªán t·ª≠.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="warning">
            <h4>L∆∞u √Ω quan tr·ªçng</h4>
            <p>‚Ä¢ N·∫øu mu·ªën tr·∫£ l·∫°i s·∫£n ph·∫©m, h√£y ƒë·∫∑t tr·ªü l·∫°i ƒë√∫ng v·ªã tr√≠ ban ƒë·∫ßu</p>
            <p>‚Ä¢ Kh√¥ng ƒë·ªÉ d·ªã v·∫≠t tr√™n k·ªá</p>
            <p><b>‚Ä¢ H·ªá th·ªëng s·∫Ω ph√°t c·∫£nh b√°o n·∫øu r·ªùi ƒëi m√† ch∆∞a thanh to√°n, nh·ªõ thanh to√°n tr∆∞·ªõc khi ƒëi b·∫°n nh√© üôè</b></p>
        </div>
    </div>
    
    <!-- Socket.IO for WebSocket communication -->
    <script src="/vendor/socket.io.min.js"></script>
    <script>
        // Initialize WebSocket for real-time shelf status
        const socket = io();
        let isConnected = false;
        
        socket.on('connect', function() {
            console.log('WebSocket connected to shelf guide page');
            isConnected = true;
            updateConnectionStatus('ƒê√£ k·∫øt n·ªëi v·ªõi h·ªá th·ªëng k·ªá');
        });
        
        socket.on('disconnect', function() {
            console.log('WebSocket disconnected from shelf guide page');
            isConnected = false;
            updateConnectionStatus('M·∫•t k·∫øt n·ªëi v·ªõi h·ªá th·ªëng k·ªá');
        });
        
        // Listen for loadcell status updates
        socket.on('loadcell_connected', function(data) {
            console.log('Loadcell connected:', data);
            updateConnectionStatus('H·ªá th·ªëng k·ªá ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng');
        });
        
        socket.on('loadcell_disconnected', function(data) {
            console.log('Loadcell disconnected:', data);
            updateConnectionStatus('H·ªá th·ªëng k·ªá t·∫°m th·ªùi m·∫•t k·∫øt n·ªëi');
        });
        
        // Listen for loadcell updates to detect taken quantities
        socket.on('loadcell_update', function(data) {
            console.log('Loadcell update received on guide page:', data);
            
            // Check for taken quantity changes and redirect to cart
            if (data.taken_quantity && Array.isArray(data.taken_quantity)) {
                const currentTakenQuantities = data.taken_quantity;
                
                // Check if any product has been taken (taken quantity > 0)
                const hasProductTaken = currentTakenQuantities.some(qty => qty > 0);
                console.log('Has product taken:', hasProductTaken, 'Current quantities:', currentTakenQuantities);
                
                if (hasProductTaken) {
                    console.log('Product taken detected on guide page, redirecting to cart page...');
                    window.location.href = '/cart';
                }
            }
        });
        
        // Update connection status display
        function updateConnectionStatus(message) {
            const statusDisplay = document.querySelector('.status-display p');
            if (statusDisplay) {
                const currentTime = new Date().toLocaleTimeString('vi-VN');
                statusDisplay.textContent = `${message} (C·∫≠p nh·∫≠t l√∫c: ${currentTime})`;
            }
        }
        
        // Listen for navigation events
        socket.on('redirect_to_cart', function(data) {
            console.log('Voice command: redirect to cart');
            window.location.href = '/cart';
        });
        
        socket.on('redirect_to_main', function(data) {
            console.log('Voice command: redirect to main page');
            window.location.href = '/';
        });
        
        socket.on('redirect_to_combo', function(data) {
            console.log('Voice command: redirect to combo page');
            window.location.href = '/combo';
        });
        
        // RFID event listener - handle employee adding max_quantity
        socket.on('employee_adding_max_quantity', function(data) {
            console.log('RFID detected: employee adding max_quantity, redirecting to shelf page');
            window.location.href = data.url || '/shelf';
        });
        
        // Add some interactive animations
        document.querySelectorAll('.feature-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });
        
        // Add click effect to navigation buttons
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', function() {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });
    </script>

    <!-- Load navigation script deferred -->
    <script src="/static/js/navigation.js" defer></script>
</body>
</html>
