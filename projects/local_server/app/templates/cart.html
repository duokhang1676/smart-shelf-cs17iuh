<!--
* Copyright 2025 Tran Vu Thuy Trang [C]
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
-->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng</title>
    
    <!-- Critical Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.socket.io" crossorigin>
    
    <!-- Critical CSS - Load synchronously -->
    <link rel="stylesheet" href="/static/css/navigation.css">
    <link rel="stylesheet" href="/static/css/cart.css">
    
    <!-- Font CSS - Load asynchronously -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Aladin&family=Montserrat:wght@300;400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Aladin&family=Montserrat:wght@300;400;500;600;700&display=swap"></noscript>
    
    <!-- Module preload for critical JS -->
    <link rel="modulepreload" href="/static/js/navigation.js">
</head>
<body>
<!-- Navigation Bar -->
<nav class="navigation-bar">
    <div class="nav-brand">
        <span class="nav-brand-text">CS17IUH</span>
    </div>
    <div class="nav-links">
        <a href="/" class="nav-link" title="Trang ch·ªß">
            <span class="nav-text">Trang ch·ªß</span>
        </a>
        <a href="/shelf" class="nav-link" title="K·ªá s·∫£n ph·∫©m">
            <span class="nav-text">K·ªá h√†ng</span>
        </a>
        <a href="/combo" class="nav-link" title="Combo khuy·∫øn m√£i">
            <span class="nav-text">Combo</span>
        </a>
        <a href="/cart" class="nav-link active" title="Gi·ªè h√†ng">
            <span class="nav-text">Gi·ªè h√†ng</span>
        </a>
        <a href="/guide" class="nav-link" title="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng k·ªá">
            <span class="nav-text">H∆∞·ªõng d·∫´n</span>
        </a>
        <div class="nav-dropdown">
            <a href="#" class="nav-link" title="C√†i ƒë·∫∑t h·ªá th·ªëng" onclick="toggleSettingsDropdown(event)">
                <img src="/static/img/setting.png" alt="Settings">
            </a>
            <div class="dropdown-menu" id="settingsDropdown">
                <a href="/sensor-data" class="dropdown-item">
                    <span>D·ªØ li·ªáu m√¥i tr∆∞·ªùng</span>
                </a>
                <a href="/mobile-app" class="dropdown-item">
                    <span>Nh√¢n vi√™n</span>
                </a>
            </div>
        </div>
    </div>
</nav>

<div class="content-wrapper">
    <div class="container">
    <!-- Connection status bar is now completely hidden - we use notifications instead -->
    <div class="connection-status-bar" id="connectionStatusBar">
        <div class="status-indicator" id="statusIndicator"></div>
        <span id="connectionStatusText">ƒêang k·∫øt n·ªëi v·ªõi loadcell...</span>
    </div>
    
    <h1>GI·ªé H√ÄNG</h1>
    
    <div class="cart-content">
        <!-- Left Column: Product Cards -->
        <div class="cart-products-section">
            <div id="cart-products-list" class="cart-products-list" style="display: none;">
                <!-- Product cards will be inserted here -->
            </div>
            
            <div id="empty-msg" class="empty-cart">
                <div class="empty-cart-icon">üõí</div>
                <h3>Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng</h3>
                <p>Vui l√≤ng l·∫•y s·∫£n ph·∫©m tr√™n k·ªá</p>
            </div>
        </div>
        
        <!-- Right Column: Order Summary -->
        <div class="order-summary">
            <h2>T√≥m t·∫Øt ƒë∆°n h√†ng</h2>
            
            <div class="summary-row subtotal-row" id="subtotal-row">
                <span class="summary-label">T·∫°m t√≠nh</span>
                <span class="summary-value amount" id="subtotal-amount">0 ‚Ç´</span>
            </div>
            
            <div class="summary-row discount-row" id="discount-row" style="display: none;">
                <span class="summary-label">Gi·∫£m gi√°</span>
                <span class="summary-value discount-amount amount">-0 ‚Ç´</span>
            </div>
            
            <div class="summary-row promotion-row" id="promotion-row" style="display: none;">
                <span class="summary-label">Ti·∫øt ki·ªám Combo</span>
                <span class="summary-value promotion-amount">-0 ‚Ç´</span>
            </div>
            
            <div class="summary-row total-row" id="total-row">
                <span class="summary-label">T·ªïng c·ªông</span>
                <span class="summary-value total-amount">0 ‚Ç´</span>
            </div>
            
            <button class="checkout-btn" onclick="confirmPayment()">
                Thanh to√°n
            </button>
            
            <button class="update-cart-btn" onclick="refreshCart()">C·∫≠p nh·∫≠t gi·ªè h√†ng</button>
        </div>
    </div>
</div>
</div>

<!-- Payment Confirmation Modal -->
<div class="modal-overlay" id="payment-confirmation-modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>X√°c nh·∫≠n thanh to√°n</h3>
        </div>
        <div class="modal-body">
            <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën thanh to√°n ƒë∆°n h√†ng n√†y kh√¥ng?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="document.getElementById('payment-confirmation-modal').style.display='none'">H·ªßy</button>
            <button class="btn btn-primary" onclick="confirmPayment(); processPayment();">
                X√°c nh·∫≠n
            </button>
            <!-- <button class="btn btn-primary" onclick="processPayment()">X√°c nh·∫≠n</button> -->
        </div>
    </div>
</div>

<!-- Product Position Error Modal -->
<div class="modal-overlay" id="productPositionErrorModal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>C·∫£nh b√°o s·∫£n ph·∫©m</h3>
        </div>
        <div class="modal-body">
            <p id="productPositionErrorMessage">S·∫£n ph·∫©m ƒë·∫∑t sai v·ªã tr√≠</p>
            <div id="errorProductList" style="margin-top: 15px;"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="closeProductPositionErrorModal()">ƒê√£ hi·ªÉu</button>
        </div>
    </div>
</div>

<!-- Print Invoice Confirmation Modal -->
<div class="modal-overlay" id="printInvoiceModal" style="display: none;" onclick="closePrintInvoiceModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3>X√°c nh·∫≠n thanh to√°n</h3>
            <button class="modal-close" onclick="closePrintInvoiceModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p>B·∫°n c√≥ mu·ªën in h√≥a ƒë∆°n kh√¥ng?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="proceedPayment(false)">Kh√¥ng</button>
            <button class="btn btn-primary" onclick="proceedPayment(true)">C√≥</button>
        </div>
    </div>
</div>

<!-- Load scripts deferred for better performance -->
<script src="/vendor/socket.io.min.js" defer></script>
<script src="/static/js/navigation.js" defer></script>
<script src="/static/js/cart.js" defer></script>
</body>
</html>
